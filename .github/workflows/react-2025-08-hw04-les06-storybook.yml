name: Test, Lint, Build and Deploy on Github Pages

on:
  push:
    # branches: ["react-2025-08-hw04-les06-storybook"]
    branches: ["master", "main"]

  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –≤—Ä—É—á–Ω—É—é –Ω–∞ –≤–∫–ª–∞–¥–∫–µ Actions
  workflow_dispatch:

permissions:
  contents: write

jobs:
  react-2025-08-hw04-les06-storybook:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: react-2025-08/react-2025-08-hw04-les06-storybook

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'

      # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: Install dependencies
        run: npm install

      # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –∏ –ª–∏–Ω—Ç–µ—Ä
      - name: Run tests and linter
        run: npm run lint && npm test

      # –°–æ–±–∏—Ä–∞–µ–º Storybook
      - name: Build Storybook
        run: npm run build-storybook

      - name: Deploy Storybook to GHP /ponomarenko-alex-otus/react-2025-08/react-2025-08-hw04-les06-storybook üöÄ
        id: Deploy-Storybook
        uses: JamesIves/github-pages-deploy-action@4.2.1
        with:
          branch: gh-pages # The branch the action should deploy to.
          folder: react-2025-08/react-2025-08-hw04-les06-storybook/storybook-static  # The folder the action should deploy.
          target-folder: react-2025-08/react-2025-08-hw04-les06-storybook
          clean: true # Automatically remove deleted files from the deploy branch


      # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
      - name: Fail on failed tests
        run: |
          if [ ${{ job.status }} == 'failure' ]; then exit 1; fi;
