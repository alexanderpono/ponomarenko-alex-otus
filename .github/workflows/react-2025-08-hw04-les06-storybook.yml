name: Test, Lint, Build and Deploy on Github Pages

on:
  push:
    # branches: ["react-2025-08-hw04-les06-storybook"]
    branches: ["master", "main"]

  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –≤—Ä—É—á–Ω—É—é –Ω–∞ –≤–∫–ª–∞–¥–∫–µ Actions
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: react-2025-08/react-2025-08-hw04-les06-storybook

    strategy:
      matrix:
        node-version: [18.x]

    steps:
      - uses: actions/checkout@v3

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}

      # - name: Cache NPM dependencies
      #   uses: actions/cache@v4
      #   with:
      #     path: ~/.npm
      #     key: ${{ runner.OS }}-npm-cache-${{ hashFiles('**/package-lock.json') }}
      #     restore-keys: |
      #       ${{ runner.OS }}-npm-cache-

      # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: Install dependencies
        run: npm install

      # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –∏ –ª–∏–Ω—Ç–µ—Ä
      # - name: Run tests and linter
      #   run: npm run lint && npm test

      # # –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      # - name: Build Application
      #   run: npm run build

      # # –ü—É–±–ª–∏–∫—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Github Pages
      # - name: Deploy to Github Pages
      #   uses: JamesIves/github-pages-deploy-action@4.2.1
      #   with:
      #     branch: gh-pages
      #     folder: dist

      # –°–æ–±–∏—Ä–∞–µ–º Storybook
      - name: Build Storybook
        run: npm run build-storybook

      # –ü—É–±–ª–∏–∫—É–µ–º Storybook –Ω–∞ Github Pages
      # - name: Deploy Storybook to Github Pages
      #   uses: JamesIves/github-pages-deploy-action@4.2.1
      #   with:
      #     branch: gh-pages
      #     folder: storybook-static
      #     commit-message: "Automatically publish Storybook"
      #     target-folder: react-2025-08/react-2025-08-hw04-les06-storybook
      - name: Deploy application to GHP /ponomarenko-alex-otus/react-2025-08/react-2025-08-hw04-les06-storybook üöÄ
        id: Deploy-app
        uses: JamesIves/github-pages-deploy-action@3.7.1
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: gh-pages # The branch the action should deploy to.
          FOLDER: react-2025-08/react-2025-08-hw04-les06-storybook/storybook-static  # The folder the action should deploy.
          TARGET_FOLDER: react-2025-08/react-2025-08-hw04-les06-storybook
          CLEAN: true # Automatically remove deleted files from the deploy branch


      # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
      # - name: Fail on failed tests
      #   run: |
      #     if [ ${{ job.status }} == 'failure' ]; then exit 1; fi;
